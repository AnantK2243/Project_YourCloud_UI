<div>
	<div>
		<h2>{{ nodeName }}</h2>
		<button (click)="goBack()"><- Back to Dashboard</button>
	</div>

	<!-- Upload Progress (always visible when uploading) -->
	<div *ngIf="isUploading">
		<span>{{ uploadStatus }}</span>
		<div>{{ uploadProgress }}%</div>
		<div *ngIf="uploadChunksInfo">{{ uploadChunksInfo }}</div>
	</div>

	<!-- Download Progress (always visible when downloading) -->
	<div *ngIf="isDownloading">
		<span>{{ downloadStatus }}</span>
		<div>{{ downloadProgress }}%</div>
		<div *ngIf="downloadChunksInfo">{{ downloadChunksInfo }}</div>
	</div>

	<!-- File Upload Section -->
	<div *ngIf="initialized && !loading && !error">
		<!-- Files Upload -->
		<input
			type="file"
			id="fileInput"
			#fileInput
			multiple
			(change)="onFilesSelected($event)"
			style="display: none"
			[disabled]="isUploading || isDownloading"
		/>
		<button
			(click)="triggerFileUpload()"
			[disabled]="isUploading || isDownloading"
		>
			{{ isUploading ? "Uploading..." : "Upload Files" }}
		</button>

		<!-- Directory Upload -->
		<input
			type="file"
			id="directoryInput"
			#directoryInput
			webkitdirectory
			(change)="onDirectorySelected($event)"
			style="display: none"
			[disabled]="isUploading || isDownloading"
		/>
		<button
			(click)="triggerDirectoryUpload()"
			[disabled]="isUploading || isDownloading"
		>
			{{ isUploading ? "Uploading..." : "Upload Directory" }}
		</button>

		<!-- Create Directory Button -->
		<button
			(click)="startCreatingDirectory()"
			[disabled]="isUploading || isCreatingDirectory || isDownloading"
		>
			Create Directory
		</button>

		<!-- Directory Creation Form -->
		<div *ngIf="isCreatingDirectory">
			<input
				type="text"
				[(ngModel)]="newDirectoryName"
				placeholder="Enter directory name"
				(keyup.enter)="createNewDirectory()"
			/>
			<button (click)="createNewDirectory()" [disabled]="loading">
				{{ loading ? "Creating..." : "Create" }}
			</button>
			<button (click)="cancelCreateDirectory()" [disabled]="loading">
				Cancel
			</button>
		</div>

		<!-- Breadcrumb Navigation -->
		<div *ngIf="initialized"><span>Path: </span> {{ getPath() }}</div>

		<!-- Go to parent -->
		<button
			(click)="leaveDirectory()"
			[disabled]="loading || isDownloading"
		>
			Back
		</button>

		<!-- Show Page Status -->
		<div *ngIf="loading">
			<p>Loading...</p>
		</div>

		<!-- Show Directory Content -->
		<div *ngIf="initialized && !loading && !error">
			<div *ngIf="directoryList.length === 0">
				<p>This directory is empty.</p>
			</div>

			<ul *ngIf="directoryList.length > 0">
				<li *ngFor="let item of directoryList">
					<div>
						<div>
							<span *ngIf="item.type === 'directory'">
								{{ item.type }} - {{ item.name }}
							</span>
							<span *ngIf="item.type === 'file'">
								{{ item.type }} - {{ item.name }}
							</span>
							<div *ngIf="item.type === 'file'">
								<span
									>{{ formatFileSize(item.size) }} -
									{{ formatDate(item.createdAt) }}</span
								>
							</div>
						</div>
						<div *ngIf="item.type === 'file'">
							<button
								(click)="onFileDownload(item)"
								[disabled]="loading || isDownloading"
								title="Download"
							>
								{{
									isDownloading
										? "Downloading..."
										: "Download"
								}}
							</button>
							<button
								(click)="deleteItem(item)"
								[disabled]="loading || isDownloading"
								title="Delete File"
							>
								{{ loading ? "Deleting..." : "Delete" }}
							</button>
						</div>
						<div *ngIf="item.type === 'directory'">
							<button
								(click)="enterDirectory(item)"
								[disabled]="loading || isDownloading"
								title="Navigate to Directory"
							>
								Enter
							</button>
							<button
								(click)="onFileDownload(item)"
								[disabled]="loading || isDownloading"
								title="Download"
							>
								{{
									isDownloading
										? "Downloading..."
										: "Download"
								}}
							</button>
							<button
								(click)="deleteItem(item)"
								[disabled]="loading || isDownloading"
								title="Delete Directory"
							>
								{{ loading ? "Deleting..." : "Delete" }}
							</button>
						</div>
					</div>
				</li>
			</ul>
		</div>

		<div *ngIf="warning">
			{{ warning }}
		</div>
		<div *ngIf="error">
			<p>{{ error }}</p>
		</div>
	</div>
</div>
